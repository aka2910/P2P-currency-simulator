import random 
from transaction import Transaction

class Peer:
    def __init__(self, id) -> None:
        self.id = id
        self.neighbors = []
        self.speed = "" # slow or fast 
        self.cpu = ""   # low or high

    
    def add_neighbor(self, neighbor):
        self.neighbors.append(neighbor)
    
    def generate_transactios(self, Ttx, time, peers):
        # generate transaction for block
        # send transaction to neighbors
        # Each peer generates transactions randomly in time. The interarrival between transactions generated by
        # time is between 0 to time. generate transactions 
        # any peer is chosen from an exponential distribution whose mean time(Ttx) can be set as a parameter of the
        transactions = []
        times = []
        start_time = 0
        while start_time < time:
            t = random.expovariate(1/Ttx)
            start_time += t
            times.append(start_time)
        for t in times:
            # choose a random peer
            receiver = random.choice(peers)
            while receiver == self:
                receiver = random.choice(peers)
            # generate a random transaction id by hashing the sender, receiver and time
            id = hash(str(self.id) + str(receiver.id) + str(t))
            
            transactions.append(Transaction(id, self, receiver, 1, t))
        return transactions
    

    